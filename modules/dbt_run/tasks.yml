tasks:
  - id: dbt
    type: io.kestra.core.tasks.flows.WorkingDirectory
    tasks:
      - id: clone_repository
        type: io.kestra.plugin.git.Clone
        url: https://github.com/kestra-io/dbt-example
        branch: master

      - id: dbt_build
        type: io.kestra.plugin.dbt.cli.DbtCLI
        retry:
          maxAttempt: ${dbt-max-attempt}
          type: constant
          interval: PT5M
          warningOnRetry: true
        taskRunner:
          type: io.kestra.plugin.scripts.runner.docker.Docker
        containerImage: ghcr.io/kestra-io/dbt-duckdb:latest
        commands:
        %{ for command in dbt-commands ~}
          - ${command}
        %{ endfor ~}
        profiles: |
        my_dbt_project:
          outputs:
            dev:
              type: duckdb
              path: dbt.duckdb
              extensions:
                - parquet
              fixed_retries: 1
              threads: 16
              timeout_seconds: 300
          target: dev
